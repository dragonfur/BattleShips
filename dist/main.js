(()=>{"use strict";var t={d:(e,a)=>{for(var r in a)t.o(a,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:a[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{t7:()=>B,ST:()=>G,_O:()=>w,cg:()=>E,J6:()=>H,gx:()=>Y});const e=class{constructor(t){this.name=t,this.currentrow,this.currentcol}attack(t,e,a){return!1!==a.board[t][e].canHit&&!!a.receiveAttack(t,e)}randomAttack(t){let e,a;do{e=Math.floor(10*Math.random()),a=Math.floor(10*Math.random())}while(!1===t.board[e][a].canHit);const r=t.receiveAttack(e,a);return this.grabCoords(e,a),!!r}grabCoords(t,e){return void 0===t||void 0===e?{y:this.currentrow,x:this.currentcol}:(this.currentrow=t,void(this.currentcol=e))}randomPlacement(t,e){let a,r,n;do{a=Math.floor(10*Math.random()),r=Math.floor(10*Math.random()),n=this.verticalRandomizer()}while(!1===t.canPlace(e,parseInt(a),parseInt(r),n));t.placeShip(e,parseInt(a),parseInt(r),n)}verticalRandomizer(){const t=1*Math.random();return t>=.5||!(t<.5)&&void 0}},a=class{constructor(){this.board=[],this.createGrid(10)}createGrid(t){for(let e=0;e<t;e++){this.board[e]=[];for(let a=0;a<t;a++)this.board[e][a]={canHit:!0}}}placeShip(t,e,a,r){if(!1!==this.canPlace(t,e,a,r))if(r)for(let r=0;r<t.length;r++)this.board[e+r][a]={ShipInfo:t,hasShip:!0,canHit:!0};else for(let r=0;r<t.length;r++)this.board[e][a+r]={ShipInfo:t,hasShip:!0,canHit:!0}}receiveAttack(t,e){if(this.board[t][e].canHit=!1,!0===this.board[t][e].hasShip){let a=this.board[t][e].ShipInfo.hits.length+1;return this.board[t][e].ShipInfo.hit(a),!0}return!1}canAttack(t,e){return!1!==this.board[t][e].canHit&&(!0===this.board[t][e].canHit||void 0)}isGameOver(){let t;for(let e=0;e<this.board.length;e++)for(let a=0;a<this.board[0].length;a++)if(!0===this.board[e][a].hasShip){if(!this.board[e][a].ShipInfo.isSunk())return!1;t=!0}return t}canPlace(t,e,a,r){if(r){if(parseInt(e)+parseInt(t.length)>10)return!1}else if(a+t.length>10)return!1;if(r){for(let r=0;r<t.length;r++)if("hasShip"in this.board[e+r][a]&&!0===this.board[e+r][a].hasShip)return!1}else for(let r=0;r<t.length;r++)if("hasShip"in this.board[e][a+r]&&!0===this.board[e][a+r].hasShip)return!1;return!0}},r=class{constructor(t,e){this.name=t,this.length=e,this.hits=[]}hit(t){this.hits.includes(t)||this.hits.push(t)}isSunk(){return this.hits.length===this.length}};function n(t,e,a){switch(e){case 0:t.textContent=`That's not the board, ${a}.`;break;case 1:t.textContent=`You can't place it there, ${a}.`;break;case 2:t.textContent=`We know there's nothing there, ${a}! Pick a different spot.`}}function o(t,e,a){t.textContent=`${e} has sunk all of ${a}'s ships.`;const r=document.createElement("button");r.textContent="Play again?",r.classList.add("Start"),r.addEventListener("click",(()=>{w()})),setTimeout((()=>{t.appendChild(r)}),4e3)}let s,i,d,c;function l(t,e,a,r,n){if(console.log(e),s=t,i=e,d=a,c=r,n){const e=t.randomAttack(i),a=t.grabCoords(),r=document.querySelector(`[data-ycoord='${a.y}'][data-xcoord='${a.x}']`);return e?(console.log("PLAYER 2 HIT YOU"),r.setAttribute("id","hit"),G(i,a.y,a.x),void B()):(console.log("PLAYER 2 MISSED YOU"),r.setAttribute("id","miss"),void B())}a.addEventListener("click",h)}function h(t){t.target.classList.contains("cell")?!0===i.canAttack(parseInt(t.target.dataset.ycoord),parseInt(t.target.dataset.xcoord))?s.attack(parseInt(t.target.dataset.ycoord),parseInt(t.target.dataset.xcoord),i)?(console.log("YOU HIT PLAYER 2"),t.target.setAttribute("id","hit"),G(i,t.target.dataset.ycoord,t.target.dataset.xcoord),B()):(console.log("YOU MISSED PLAYER 2"),B(),t.target.setAttribute("id","miss")):(n(c,2,s.name),l(s,i,d,c,!1)):(n(c,1,s.name),l(s,i,d,c,!1))}const u=[{name:"Carrier",length:5},{name:"Battleship",length:4},{name:"Cruiser",length:3},{name:"Submarine",length:3},{name:"Destroyer",length:2}],p=document.querySelector('[data-id="start"]'),m=document.querySelector('[data-id="status"]'),f=document.querySelector('[data-id="playerOneNameSelector"]'),g=document.querySelector('[data-id="enterName"]'),y=document.querySelector('[data-id="nameChosenPlayerOne"]'),C=document.querySelector('[data-id="playerGridName"]'),v=document.querySelector('[data-id="gridPlayerOne"]'),b=document.querySelector('[data-id="gridPlayerTwo"]');let S;p.addEventListener("click",(()=>{p.style.display="none",f.style.display="flex"})),g.addEventListener("click",(()=>{let t="mate";var a;""===y.value?(C.textContent="YOUR FLEET",t="Captain"):(t=y.value,C.textContent=`${t.toUpperCase()}'S FLEET`,y.value=""),f.style.display="none",m.textContent=`Time to place your ships, ${t}.`,a=m,setTimeout((()=>{a.textContent="Let's start with your biggest ship, the Carrier."}),3e3),setTimeout((()=>{E(0)}),6e3),$(x,v,"player1"),$(L,b,"player2"),S=new e(`${t}`)}));let x=new a,L=new a,I=new e("Mr. Bot");function w(){x=new a,L=new a,function(){v.innerHTML="";for(let t=0;t<11;t++){const e=document.createElement("div");e.classList.add("cellCoord"),e.classList.add("yCoord"),0===t?(e.textContent="",v.appendChild(e)):(e.textContent=`${String.fromCharCode(64+t)}`,v.appendChild(e))}b.innerHTML="";for(let t=0;t<11;t++){const e=document.createElement("div");e.classList.add("cellCoord"),e.classList.add("yCoord"),10===t?(e.textContent="",b.appendChild(e)):(e.textContent=`${String.fromCharCode(65+t)}`,b.appendChild(e))}}(),$(x,v,"player1"),$(L,b,"player2"),E(0),P=1,T=!1,U="playerOne"}function $(t,e,a){for(let r=0;r<t.board.length;r++)for(let n=-1;n<t.board.length;n++)if("player1"===a)if(-1===n){const t=document.createElement("div");t.textContent=`${r+1}`,t.setAttribute("class","cellCoord"),e.appendChild(t)}else{const t=document.createElement("div");t.setAttribute("class","cell"),t.setAttribute("data-yCoord",r),t.setAttribute("data-xCoord",n),e.appendChild(t)}else if("player2"===a)if(n<9){const t=document.createElement("div");t.setAttribute("class","cell"),t.setAttribute("data-yCoord",r),t.setAttribute("data-xCoord",n+1),e.appendChild(t)}else{const t=document.createElement("div");t.textContent=`${r+1}`,t.setAttribute("class","cellCoord"),e.appendChild(t)}}function E(t){if(parseInt(t)===u.length)return e=m,a=S.name,e.textContent=`Alright, you're all set, ${a}.`,setTimeout((()=>{e.textContent="You're up for the first shot, let's get them!"}),1500),setTimeout((()=>{e.textContent=""}),4e3),u.forEach((t=>{let e=new r(t.name,t.length);I.randomPlacement(L,e)})),void B();var e,a;let n=new r(u[t].name,u[t].length);!function(t,e){if("Carrier"===e.name)t.textContent="Where would you like to place your Carrier?",H(),Y();else if("Battleship"===e.name)t.textContent="How about the Battleship?",H(),Y();else if("Cruiser"===e.name)t.textContent="How about the Cruiser ship?",H(),Y();else if("Submarine"===e.name)t.textContent="Can't forget about our Submarines now, can we?",H(),Y();else{if("Destroyer"!==e.name)return;t.textContent="Last, but not least, our 'Destroyer'?",H(),Y()}}(m,n),k=n}let k,A,O,P=1,T=!1;function q(t){return t?"Vertical":"Horizontal"}function H(){const t=function(t){const e=document.createElement("button");return e.classList.add("changeDirection"),t.appendChild(e),e}(m);t.textContent=q(T),t.addEventListener("click",(()=>{T=!T,t.textContent=q(T)})),v.addEventListener("click",M,{once:!0})}function M(t){t.target.classList.contains("cell")?!0===x.canPlace(k,parseInt(t.target.dataset.ycoord),parseInt(t.target.dataset.xcoord),T)?(function(t){if(t.target.classList.add(`${O.name.toLowerCase()}`),T)for(let t=0;t<O.length;t++)document.querySelector(`[data-ycoord="${parseInt(A.row)+t}"][data-xcoord="${parseInt(A.col)}"]`).classList.add(`${O.name.toLowerCase()}`);else for(let t=0;t<O.length;t++)document.querySelector(`[data-ycoord="${parseInt(A.row)}"][data-xcoord="${parseInt(A.col)+t}"]`).classList.add(`${O.name.toLowerCase()}`)}(t),x.placeShip(k,parseInt(t.target.dataset.ycoord),parseInt(t.target.dataset.xcoord),T),v.removeEventListener("mouseover",R),v.removeEventListener("mouseleave",D),E(P),P++):(n(m,1,S.name),H()):(n(m,0,S.name),H())}function Y(){v.addEventListener("mouseover",R)}function R(t){if(t.target.classList.contains("cell")&&!0===x.canPlace(k,parseInt(t.target.dataset.ycoord),parseInt(t.target.dataset.xcoord),T)){if(t.target.classList.add("selected"),e=A={row:t.target.dataset.ycoord,col:t.target.dataset.xcoord},A=e,T)for(let t=0;t<k.length;t++)document.querySelector(`[data-ycoord="${parseInt(A.row)+t}"][data-xcoord="${parseInt(A.col)}"]`).classList.add("selected");else for(let t=0;t<k.length;t++)document.querySelector(`[data-ycoord="${parseInt(A.row)}"][data-xcoord="${parseInt(A.col)+t}"]`).classList.add("selected");O=k,t.target.addEventListener("mouseleave",D)}var e}function D(t){if(t.target.classList.remove("selected"),T)for(let t=0;t<O.length;t++)document.querySelector(`[data-ycoord="${parseInt(A.row)+t}"][data-xcoord="${parseInt(A.col)}"]`).classList.remove("selected");else for(let t=0;t<O.length;t++)document.querySelector(`[data-ycoord="${parseInt(A.row)}"][data-xcoord="${parseInt(A.col)+t}"]`).classList.remove("selected")}let U="playerOne";function B(){let t;return t=("playerOne"===U?x:L).isGameOver(),t?("playerOne"===U?o(m,I.name,S.name):o(m,S.name,I.name),void b.removeEventListener("click",h)):"playerOne"===U?(U="playerTwo",void l(S,L,b,m,!1)):"playerTwo"===U?"Mr. Bot"===I.name?(U="playerOne",void l(I,x,v,m,!0)):(U="playerOne",void l(I,x,v,m,!1)):void 0}function G(t,e,a){var r,n;t.board[e][a].ShipInfo.isSunk()&&(r=m,n=t.board[e][a].ShipInfo.name,r.textContent=`Ship down! You have sunk their ${n}.`,setTimeout((()=>{r.textContent=""}),4e3))}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoibUJBQ0EsSUFBSUEsRUFBc0IsQ0NBMUJBLEVBQXdCLENBQUNDLEVBQVNDLEtBQ2pDLElBQUksSUFBSUMsS0FBT0QsRUFDWEYsRUFBb0JJLEVBQUVGLEVBQVlDLEtBQVNILEVBQW9CSSxFQUFFSCxFQUFTRSxJQUM1RUUsT0FBT0MsZUFBZUwsRUFBU0UsRUFBSyxDQUFFSSxZQUFZLEVBQU1DLElBQUtOLEVBQVdDLE1DSjNFSCxFQUF3QixDQUFDUyxFQUFLQyxJQUFVTCxPQUFPTSxVQUFVQyxlQUFlQyxLQUFLSixFQUFLQyxJLGdFQzBFbEYsUUExRUEsTUFFSUksWUFBWUMsR0FDUkMsS0FBS0QsS0FBT0EsRUFDWkMsS0FBS0MsV0FDTEQsS0FBS0UsV0FHVEMsT0FBT0MsRUFBS0MsRUFBS0MsR0FDYixPQUF5QyxJQUFyQ0EsRUFBVUMsTUFBTUgsR0FBS0MsR0FBS0csVUFHVkYsRUFBVUcsY0FBY0wsRUFBS0MsR0FTckRLLGFBQWFKLEdBQ1QsSUFBSUYsRUFDQUMsRUFDSixHQUNJRCxFQUFNTyxLQUFLQyxNQUFzQixHQUFoQkQsS0FBS0UsVUFDdEJSLEVBQU1NLEtBQUtDLE1BQXNCLEdBQWhCRCxLQUFLRSxpQkFFa0IsSUFBckNQLEVBQVVDLE1BQU1ILEdBQUtDLEdBQUtHLFFBQ2pDLE1BQU1NLEVBQVVSLEVBQVVHLGNBQWNMLEVBQUtDLEdBRTdDLE9BREFMLEtBQUtlLFdBQVdYLEVBQUlDLEtBQ2hCUyxFQU9SQyxXQUFXWCxFQUFLQyxHQUNaLFlBQVlXLElBQVJaLFFBQTZCWSxJQUFSWCxFQUNkLENBQ0hZLEVBQUdqQixLQUFLQyxXQUNSaUIsRUFBR2xCLEtBQUtFLGFBR1pGLEtBQUtDLFdBQWFHLE9BQ2xCSixLQUFLRSxXQUFhRyxJQUsxQmMsZ0JBQWdCYixFQUFXYyxHQUN2QixJQUFJaEIsRUFDQUMsRUFDQWdCLEVBQ0osR0FDSWpCLEVBQU1PLEtBQUtDLE1BQXNCLEdBQWhCRCxLQUFLRSxVQUN0QlIsRUFBTU0sS0FBS0MsTUFBc0IsR0FBaEJELEtBQUtFLFVBQ3RCUSxFQUFXckIsS0FBS3NCLDRCQUV3RCxJQUFyRWhCLEVBQVVpQixTQUFTSCxFQUFNSSxTQUFTcEIsR0FBTW9CLFNBQVNuQixHQUFNZ0IsSUFDOURmLEVBQVVtQixVQUFVTCxFQUFNSSxTQUFTcEIsR0FBTW9CLFNBQVNuQixHQUFNZ0IsR0FHNURDLHFCQUNJLE1BQU1JLEVBQTZCLEVBQWhCZixLQUFLRSxTQUN4QixPQUFJYSxHQUFjLE1BRVBBLEVBQWEsVUFBakIsSUMrQ2YsRUFoSEEsTUFFSTVCLGNBQ0lFLEtBQUtPLE1BQVEsR0FDYlAsS0FBSzJCLFdBQVcsSUFHcEJBLFdBQVdDLEdBQ1AsSUFBSyxJQUFJeEIsRUFBTSxFQUFHQSxFQUFNd0IsRUFBTXhCLElBQU8sQ0FDakNKLEtBQUtPLE1BQU1ILEdBQU8sR0FDbEIsSUFBSyxJQUFJQyxFQUFNLEVBQUdBLEVBQU11QixFQUFNdkIsSUFDMUJMLEtBQUtPLE1BQU1ILEdBQUtDLEdBQU8sQ0FDbkJHLFFBQVEsSUFNeEJpQixVQUFVSSxFQUFNekIsRUFBS0MsRUFBS2dCLEdBRXRCLElBQWdELElBQTVDckIsS0FBS3VCLFNBQVNNLEVBQU16QixFQUFLQyxFQUFLZ0IsR0FJbEMsR0FBSUEsRUFDQSxJQUFLLElBQUlTLEVBQUksRUFBR0EsRUFBSUQsRUFBS0UsT0FBUUQsSUFDakM5QixLQUFLTyxNQUFNSCxFQUFNMEIsR0FBR3pCLEdBQU8sQ0FDdkIyQixTQUFVSCxFQUNWSSxTQUFTLEVBQ1R6QixRQUFRLFFBR1osSUFBSyxJQUFJMEIsRUFBSSxFQUFHQSxFQUFJTCxFQUFLRSxPQUFRRyxJQUM3QmxDLEtBQUtPLE1BQU1ILEdBQUtDLEVBQU02QixHQUFLLENBQ3ZCRixTQUFVSCxFQUNWSSxTQUFTLEVBQ1R6QixRQUFRLEdBTXhCQyxjQUFjTCxFQUFLQyxHQUVmLEdBREFMLEtBQUtPLE1BQU1ILEdBQUtDLEdBQUtHLFFBQVMsR0FDTyxJQUFqQ1IsS0FBS08sTUFBTUgsR0FBS0MsR0FBSzRCLFFBQWtCLENBQ3ZDLElBQUlFLEVBQVluQyxLQUFLTyxNQUFNSCxHQUFLQyxHQUFLMkIsU0FBU0ksS0FBVyxPQUFJLEVBRTdELE9BREFwQyxLQUFLTyxNQUFNSCxHQUFLQyxHQUFLMkIsU0FBU0ssSUFBSUYsSUFDM0IsRUFFUCxPQUFPLEVBSWZHLFVBQVVsQyxFQUFLQyxHQUNYLE9BQW9DLElBQWhDTCxLQUFLTyxNQUFNSCxHQUFLQyxHQUFLRyxVQUVrQixJQUFoQ1IsS0FBS08sTUFBTUgsR0FBS0MsR0FBS0csYUFHNUIsR0FJUitCLGFBQ0ksSUFBSUMsRUFDSixJQUFLLElBQUlWLEVBQUksRUFBR0EsRUFBSTlCLEtBQUtPLE1BQU13QixPQUFRRCxJQUNuQyxJQUFLLElBQUlJLEVBQUksRUFBR0EsRUFBSWxDLEtBQUtPLE1BQU0sR0FBR3dCLE9BQVFHLElBQ3RDLElBQWlDLElBQTdCbEMsS0FBS08sTUFBTXVCLEdBQUdJLEdBQUdELFFBQWtCLENBQ25DLElBQUtqQyxLQUFLTyxNQUFNdUIsR0FBR0ksR0FBR0YsU0FBU1MsU0FDM0IsT0FBTyxFQUVQRCxHQUFXLEVBSzNCLE9BQU9BLEVBR1hqQixTQUFTSCxFQUFNaEIsRUFBS0MsRUFBS2dCLEdBQ3JCLEdBQUlBLEdBQ0EsR0FBS0csU0FBU3BCLEdBQU9vQixTQUFTSixFQUFLVyxRQUFXLEdBQzFDLE9BQU8sT0FHWCxHQUFLMUIsRUFBTWUsRUFBS1csT0FBVSxHQUN0QixPQUFPLEVBS2YsR0FBSVYsR0FDQSxJQUFLLElBQUlTLEVBQUksRUFBR0EsRUFBSVYsRUFBS1csT0FBUUQsSUFDN0IsR0FBSSxZQUFhOUIsS0FBS08sTUFBTUgsRUFBSTBCLEdBQUd6QixLQUNVLElBQXJDTCxLQUFLTyxNQUFNSCxFQUFNMEIsR0FBR3pCLEdBQUs0QixRQUN6QixPQUFPLE9BS25CLElBQUssSUFBSUMsRUFBSSxFQUFHQSxFQUFJZCxFQUFLVyxPQUFRRyxJQUM3QixHQUFJLFlBQWFsQyxLQUFLTyxNQUFNSCxHQUFLQyxFQUFJNkIsS0FDUSxJQUFyQ2xDLEtBQUtPLE1BQU1ILEdBQUtDLEVBQU02QixHQUFHRCxRQUN6QixPQUFPLEVBS3ZCLE9BQU8sSUMzRmYsRUFwQkEsTUFDSW5DLFlBQWFDLEVBQU1nQyxHQUNmL0IsS0FBS0QsS0FBT0EsRUFDWkMsS0FBSytCLE9BQVNBLEVBQ2QvQixLQUFLb0MsS0FBTyxHQUdoQkMsSUFBSUssR0FDSTFDLEtBQUtvQyxLQUFLTyxTQUFTRCxJQUduQjFDLEtBQUtvQyxLQUFLUSxLQUFLRixHQUl2QkQsU0FDSSxPQUFPekMsS0FBS29DLEtBQUtMLFNBQVcvQixLQUFLK0IsU0NKekMsU0FBU2MsRUFBYUMsRUFBUUosRUFBUTNDLEdBQ3RDLE9BQVEyQyxHQUNKLEtBQUssRUFDREksRUFBT0MsWUFBYyx5QkFBeUJoRCxLQUM5QyxNQUNKLEtBQUssRUFDRCtDLEVBQU9DLFlBQWMsNkJBQTZCaEQsS0FDbEQsTUFDSixLQUFLLEVBQ0QrQyxFQUFPQyxZQUFjLGtDQUFrQ2hELDZCQTREL0QsU0FBU2lELEVBQVFGLEVBQVFHLEVBQVlDLEdBQ2pDSixFQUFPQyxZQUFjLEdBQUdFLHFCQUE4QkMsYUFDdEQsTUFBTUMsRUFBVUMsU0FBU0MsY0FBYyxVQUN2Q0YsRUFBUUosWUFBYyxjQUN0QkksRUFBUUcsVUFBVUMsSUFBSSxTQUN0QkosRUFBUUssaUJBQWlCLFNBQVMsS0FDOUJDLE9BRUpDLFlBQVcsS0FDUFosRUFBT2EsWUFBWVIsS0FDcEIsS0N2RlAsSUFBSVMsRUFDQUMsRUFDQUMsRUFDQUMsRUFFSixTQUFTQyxFQUFZQyxFQUFRM0QsRUFBVzRELEVBQU1wQixFQUFRcUIsR0FNbEQsR0FMQUMsUUFBUUMsSUFBSS9ELEdBQ1pzRCxFQUFnQkssRUFDaEJKLEVBQW1CdkQsRUFDbkJ3RCxFQUFjSSxFQUNkSCxFQUFnQmpCLEVBQ1pxQixFQUFJLENBQ0osTUFBTXJELEVBQVVtRCxFQUFPdkQsYUFBYW1ELEdBQzlCUyxFQUFTTCxFQUFPbEQsYUFDaEJ3RCxFQUFPbkIsU0FBU29CLGNBQ2xCLGlCQUFpQkYsRUFBT3JELG9CQUFvQnFELEVBQU9wRCxPQUV2RCxPQUFJSixHQUNBc0QsUUFBUUMsSUFBSSxvQkFDWkUsRUFBS0UsYUFBYSxLQUFNLE9BQ3hCQyxFQUFjYixFQUFrQlMsRUFBT3JELEVBQUdxRCxFQUFPcEQsUUFDakR5RCxNQUdBUCxRQUFRQyxJQUFJLHVCQUNaRSxFQUFLRSxhQUFhLEtBQU0sYUFDeEJFLEtBSUpULEVBQUtWLGlCQUFpQixRQUFTb0IsR0FJdkMsU0FBU0EsRUFBVUMsR0FDWEEsRUFBRUMsT0FBT3hCLFVBQVV5QixTQUFTLFNBSXRCLElBSEZsQixFQUFpQnZCLFVBQ2pCZCxTQUFTcUQsRUFBRUMsT0FBT0UsUUFBUUMsUUFDMUJ6RCxTQUFTcUQsRUFBRUMsT0FBT0UsUUFBUUUsU0FFVnRCLEVBQWN6RCxPQUMxQnFCLFNBQVNxRCxFQUFFQyxPQUFPRSxRQUFRQyxRQUMxQnpELFNBQVNxRCxFQUFFQyxPQUFPRSxRQUFRRSxRQUMxQnJCLElBR0FPLFFBQVFDLElBQUksb0JBQ1pRLEVBQUVDLE9BQU9MLGFBQWEsS0FBTSxPQUM1QkMsRUFBY2IsRUFBa0JnQixFQUFFQyxPQUFPRSxRQUFRQyxPQUFRSixFQUFFQyxPQUFPRSxRQUFRRSxRQUMxRVAsTUFFQVAsUUFBUUMsSUFBSSx1QkFDWk0sSUFDQUUsRUFBRUMsT0FBT0wsYUFBYSxLQUFNLFVBR2hDNUIsRUFBYWtCLEVBQWUsRUFBR0gsRUFBYzdELE1BQzdDaUUsRUFBWUosRUFBZUMsRUFBa0JDLEVBQWFDLEdBQWUsS0FHN0VsQixFQUFha0IsRUFBZSxFQUFHSCxFQUFjN0QsTUFDN0NpRSxFQUFZSixFQUFlQyxFQUFrQkMsRUFBYUMsR0FBZSxJQzFEakYsTUFBTW9CLEVBQWlCLENBQ25CLENBQ0lwRixLQUFNLFVBQ05nQyxPQUFRLEdBRVosQ0FDSWhDLEtBQU0sYUFDTmdDLE9BQVEsR0FFWixDQUNJaEMsS0FBTSxVQUNOZ0MsT0FBUSxHQUVaLENBQ0loQyxLQUFNLFlBQ05nQyxPQUFRLEdBRVosQ0FDSWhDLEtBQU0sWUFDTmdDLE9BQVEsSUFLVnFELEVBQVloQyxTQUFTb0IsY0FBYyxxQkFDbkNhLEVBQWFqQyxTQUFTb0IsY0FBYyxzQkFDcENjLEVBQWlCbEMsU0FBU29CLGNBQWMscUNBQ3hDZSxFQUFZbkMsU0FBU29CLGNBQWMseUJBQ25DZ0IsRUFBc0JwQyxTQUFTb0IsY0FBYyxtQ0FDN0NpQixFQUFnQnJDLFNBQVNvQixjQUFjLDhCQUd2Q2tCLEVBQWdCdEMsU0FBU29CLGNBQWMsNkJBQ3ZDbUIsRUFBZ0J2QyxTQUFTb0IsY0FBYyw2QkFRN0MsSUFBSW9CLEVBTEpSLEVBQVU1QixpQkFBaUIsU0FBUyxLQUNoQzRCLEVBQVVTLE1BQU1DLFFBQVUsT0FDMUJSLEVBQWVPLE1BQU1DLFFBQVUsVUFLbkNQLEVBQVUvQixpQkFBaUIsU0FBUyxLQUNoQyxJQUFJdUMsRUFBZ0IsT0ZoRHhCLElBQWtCakQsRUVpRG9CLEtBQTlCMEMsRUFBb0JRLE9BQ3BCUCxFQUFjMUMsWUFBYyxhQUM1QmdELEVBQWdCLFlBRWhCQSxFQUFnQlAsRUFBb0JRLE1BQ3BDUCxFQUFjMUMsWUFBYyxHQUFHZ0QsRUFBY0Usd0JBQzdDVCxFQUFvQlEsTUFBUSxJQUVoQ1YsRUFBZU8sTUFBTUMsUUFBVSxPQUMvQlQsRUFBV3RDLFlBQWMsNkJBQTZCZ0QsS0YxRHhDakQsRUUyREx1QyxFRjFEVDNCLFlBQVcsS0FDUFosRUFBT0MsWUFBYyxxREFDdEIsS0FDSFcsWUFBVyxLQUNQd0MsRUFBWSxLQUNiLEtFdURIQyxFQUFRQyxFQUFvQlYsRUFBZSxXQUMzQ1MsRUFBUUUsRUFBb0JWLEVBQWUsV0FFM0NDLEVBQVksSUFBSSxFQUFPLEdBQUdHLFFBSTlCLElBQUlLLEVBQXFCLElBQUksRUFDekJDLEVBQXFCLElBQUksRUFDekJDLEVBQVksSUFBSSxFQUFPLFdBRTNCLFNBQVM3QyxJQUNMMkMsRUFBcUIsSUFBSSxFQUN6QkMsRUFBcUIsSUFBSSxFQWE3QixXQUNJWCxFQUFjYSxVQUFZLEdBQzFCLElBQUssSUFBSXpFLEVBQUksRUFBR0EsRUFBSSxHQUFJQSxJQUFLLENBQ3pCLE1BQU0wRSxFQUFjcEQsU0FBU0MsY0FBYyxPQUMzQ21ELEVBQVlsRCxVQUFVQyxJQUFJLGFBQzFCaUQsRUFBWWxELFVBQVVDLElBQUksVUFDaEIsSUFBTnpCLEdBQ0EwRSxFQUFZekQsWUFBYyxHQUMxQjJDLEVBQWMvQixZQUFZNkMsS0FFMUJBLEVBQVl6RCxZQUFjLEdBQUcwRCxPQUFPQyxhQUFhLEdBQUc1RSxLQUNwRDRELEVBQWMvQixZQUFZNkMsSUFJbENiLEVBQWNZLFVBQVksR0FDMUIsSUFBSyxJQUFJckUsRUFBSSxFQUFHQSxFQUFJLEdBQUlBLElBQUssQ0FDekIsTUFBTXNFLEVBQWNwRCxTQUFTQyxjQUFjLE9BQzNDbUQsRUFBWWxELFVBQVVDLElBQUksYUFDMUJpRCxFQUFZbEQsVUFBVUMsSUFBSSxVQUNoQixLQUFOckIsR0FDQXNFLEVBQVl6RCxZQUFjLEdBQzFCNEMsRUFBY2hDLFlBQVk2QyxLQUUxQkEsRUFBWXpELFlBQWMsR0FBRzBELE9BQU9DLGFBQWEsR0FBR3hFLEtBQ3BEeUQsRUFBY2hDLFlBQVk2QyxLQXJDbENHLEdBRUFSLEVBQVFDLEVBQW9CVixFQUFlLFdBQzNDUyxFQUFRRSxFQUFvQlYsRUFBZSxXQUUzQ08sRUFBWSxHQUNaVSxFQUFJLEVBQ0p2RixHQUFXLEVBQ1gsRUFBZ0IsWUFxQ3BCLFNBQVM4RSxFQUFRN0YsRUFBVzRELEVBQU1ELEdBQzlCLElBQUssSUFBSW5DLEVBQUksRUFBR0EsRUFBSXhCLEVBQVVDLE1BQU13QixPQUFRRCxJQUNwQyxJQUFLLElBQUlJLEdBQUssRUFBR0EsRUFBSTVCLEVBQVVDLE1BQU13QixPQUFRRyxJQUN6QyxHQUFlLFlBQVgrQixFQUNBLElBQVcsSUFBUC9CLEVBQVUsQ0FDVixNQUFNMkUsRUFBU3pELFNBQVNDLGNBQWMsT0FDdEN3RCxFQUFPOUQsWUFBYyxHQUFHakIsRUFBRyxJQUMzQitFLEVBQU9wQyxhQUFhLFFBQVMsYUFFN0JQLEVBQUtQLFlBQVlrRCxPQUNkLENBQ0gsTUFBTXRDLEVBQU9uQixTQUFTQyxjQUFjLE9BQ3BDa0IsRUFBS0UsYUFBYSxRQUFTLFFBQzNCRixFQUFLRSxhQUFhLGNBQWUzQyxHQUNqQ3lDLEVBQUtFLGFBQWEsY0FBZXZDLEdBQ2pDZ0MsRUFBS1AsWUFBWVksUUFFbEIsR0FBZSxZQUFYTixFQUNQLEdBQUkvQixFQUFJLEVBQUcsQ0FDUCxNQUFNcUMsRUFBT25CLFNBQVNDLGNBQWMsT0FDcENrQixFQUFLRSxhQUFhLFFBQVMsUUFDM0JGLEVBQUtFLGFBQWEsY0FBZTNDLEdBQ2pDeUMsRUFBS0UsYUFBYSxjQUFldkMsRUFBRyxHQUNwQ2dDLEVBQUtQLFlBQVlZLE9BQ2QsQ0FDSCxNQUFNc0MsRUFBU3pELFNBQVNDLGNBQWMsT0FDdEN3RCxFQUFPOUQsWUFBYyxHQUFHakIsRUFBRyxJQUMzQitFLEVBQU9wQyxhQUFhLFFBQVMsYUFDN0JQLEVBQUtQLFlBQVlrRCxJQU96QyxTQUFTWCxFQUFZWSxHQUNqQixHQUFJdEYsU0FBU3NGLEtBQWdCM0IsRUFBZXBELE9BRXhDLE9GakdlZSxFRXVPTHVDLEVGdk9hdEYsRUV1T0Q2RixFQUFVN0YsS0Z0T3BDK0MsRUFBT0MsWUFBYyw0QkFBNEJoRCxLQUNqRDJELFlBQVcsS0FDUFosRUFBT0MsWUFBYyxrREFDdEIsTUFDSFcsWUFBVyxLQUNQWixFQUFPQyxZQUFjLEtBQ3RCLEtFbU9Ib0MsRUFBZTRCLFNBQVEzRixJQUNuQixJQUFJNEYsRUFBVSxJQUFJLEVBQUs1RixFQUFLckIsS0FBTXFCLEVBQUtXLFFBQ3ZDdUUsRUFBVW5GLGdCQUFnQmtGLEVBQW9CVyxXQUdsRHJDLElBVEosSUZ0T3VCN0IsRUFBUS9DLEVFbUczQixJQUFJcUIsRUFBTyxJQUFJLEVBQUsrRCxFQUFlMkIsR0FBWS9HLEtBQU1vRixFQUFlMkIsR0FBWS9FLFNGeklwRixTQUE2QmUsRUFBUW1FLEdBQ2pDLEdBQXNCLFlBQWxCQSxFQUFTbEgsS0FDVCtDLEVBQU9DLFlBQWMsOENBQ3JCbUUsSUFDQUMsU0FFQyxHQUFzQixlQUFsQkYsRUFBU2xILEtBQ2QrQyxFQUFPQyxZQUFjLDRCQUNyQm1FLElBQ0FDLFNBRUMsR0FBc0IsWUFBbEJGLEVBQVNsSCxLQUNkK0MsRUFBT0MsWUFBYyw4QkFDckJtRSxJQUNBQyxTQUVDLEdBQXNCLGNBQWxCRixFQUFTbEgsS0FDZCtDLEVBQU9DLFlBQWMsaURBQ3JCbUUsSUFDQUMsUUFFQyxJQUFzQixjQUFsQkYsRUFBU2xILEtBTWQsT0FMQStDLEVBQU9DLFlBQWMsd0NBQ3JCbUUsSUFDQUMsS0VrSEpDLENBQW9CL0IsRUFBWWpFLEdBV3pCaUcsRUFWUWpHLEVBR25CLElBRUlpRyxFQUNBL0MsRUFDQWdELEVBSkFWLEVBQUksRUFDSnZGLEdBQVcsRUFhZixTQUFTa0csRUFBaUJsRyxHQUN0QixPQUFJQSxFQUNNLFdBRUMsYUFZZixTQUFTNkYsSUFDTCxNQUFNTSxFRjlJVixTQUF5QjFFLEdBQ3JCLE1BQU0yRSxFQUFrQnJFLFNBQVNDLGNBQWMsVUFHL0MsT0FGQW9FLEVBQWdCbkUsVUFBVUMsSUFBSSxtQkFDOUJULEVBQU9hLFlBQVk4RCxHQUNaQSxFRTBJaUJDLENBQWdCckMsR0FDeENtQyxFQUFnQnpFLFlBQWN3RSxFQUFpQmxHLEdBQy9DbUcsRUFBZ0JoRSxpQkFBaUIsU0FBUyxLQXRCbkNuQyxHQUFZQSxFQXdCZm1HLEVBQWdCekUsWUFBY3dFLEVBQWlCbEcsTUFFbkRxRSxFQUFjbEMsaUJBQWlCLFFBQVNtRSxFQUFXLENBQUNDLE1BQU0sSUFHOUQsU0FBU0QsRUFBVTlDLEdBQ1hBLEVBQUVDLE9BQU94QixVQUFVeUIsU0FBUyxTQUNxRyxJQUE3SHFCLEVBQW1CN0UsU0FBUzhGLEVBQWE3RixTQUFTcUQsRUFBRUMsT0FBT0UsUUFBUUMsUUFBU3pELFNBQVNxRCxFQUFFQyxPQUFPRSxRQUFRRSxRQUFTN0QsSUFnQjNILFNBQWtCd0QsR0FFZCxHQURBQSxFQUFFQyxPQUFPeEIsVUFBVUMsSUFBSSxHQUFHK0QsRUFBYXZILEtBQUs4SCxpQkFDeEN4RyxFQUNBLElBQUssSUFBSWEsRUFBSSxFQUFHQSxFQUFJb0YsRUFBYXZGLE9BQVFHLElBQ2hCa0IsU0FBU29CLGNBQWMsaUJBQWlCaEQsU0FBUzhDLEVBQU9sRSxLQUFPOEIsb0JBQW9CVixTQUFTOEMsRUFBT2pFLFVBQzNHaUQsVUFBVUMsSUFBSSxHQUFHK0QsRUFBYXZILEtBQUs4SCxzQkFHcEQsSUFBSyxJQUFJL0YsRUFBSSxFQUFHQSxFQUFJd0YsRUFBYXZGLE9BQVFELElBQ2hCc0IsU0FBU29CLGNBQWMsaUJBQWlCaEQsU0FBUzhDLEVBQU9sRSx1QkFBdUJvQixTQUFTOEMsRUFBT2pFLEtBQU95QixPQUM5R3dCLFVBQVVDLElBQUksR0FBRytELEVBQWF2SCxLQUFLOEgsaUJBekJoREMsQ0FBU2pELEdBQ1R1QixFQUFtQjNFLFVBQVU0RixFQUFhN0YsU0FBU3FELEVBQUVDLE9BQU9FLFFBQVFDLFFBQVN6RCxTQUFTcUQsRUFBRUMsT0FBT0UsUUFBUUUsUUFBUzdELEdBNEV4SHFFLEVBQWNxQyxvQkFBb0IsWUFBYUMsR0FDL0N0QyxFQUFjcUMsb0JBQW9CLGFBQWNFLEdBM0V4Qy9CLEVBQVlVLEdBQ1pBLE1BRUEvRCxFQUFhd0MsRUFBWSxFQUFHTyxFQUFVN0YsTUFDdENtSCxNQUdKckUsRUFBYXdDLEVBQVksRUFBR08sRUFBVTdGLE1BQ3RDbUgsS0FtQlIsU0FBU0MsSUFDTHpCLEVBQWNsQyxpQkFBaUIsWUFBYXdFLEdBR2hELFNBQVNBLEVBQW1CbkQsR0FDeEIsR0FBSUEsRUFBRUMsT0FBT3hCLFVBQVV5QixTQUFTLFVBQ3FHLElBQTdIcUIsRUFBbUI3RSxTQUFTOEYsRUFBYTdGLFNBQVNxRCxFQUFFQyxPQUFPRSxRQUFRQyxRQUFTekQsU0FBU3FELEVBQUVDLE9BQU9FLFFBQVFFLFFBQVM3RCxHQUFvQixDQU9uSSxHQU5Bd0QsRUFBRUMsT0FBT3hCLFVBQVVDLElBQUksWUExRGhCMkUsRUEyREc1RCxFQUFTLENBQ2ZsRSxJQUFLeUUsRUFBRUMsT0FBT0UsUUFBUUMsT0FDdEI1RSxJQUFLd0UsRUFBRUMsT0FBT0UsUUFBUUUsUUE1RDNCWixFQUFTNEQsRUErREo3RyxFQUNBLElBQUssSUFBSWEsRUFBSSxFQUFHQSxFQUFJbUYsRUFBWXRGLE9BQVFHLElBQ2ZrQixTQUFTb0IsY0FBYyxpQkFBaUJoRCxTQUFTOEMsRUFBT2xFLEtBQU84QixvQkFBb0JWLFNBQVM4QyxFQUFPakUsVUFDM0dpRCxVQUFVQyxJQUFJLGlCQUcvQixJQUFLLElBQUl6QixFQUFJLEVBQUdBLEVBQUl1RixFQUFZdEYsT0FBUUQsSUFDZnNCLFNBQVNvQixjQUFjLGlCQUFpQmhELFNBQVM4QyxFQUFPbEUsdUJBQXVCb0IsU0FBUzhDLEVBQU9qRSxLQUFPeUIsT0FDOUd3QixVQUFVQyxJQUFJLFlBbkVwQytELEVBQWVELEVBdUVkeEMsRUFBRUMsT0FBT3RCLGlCQUFpQixhQUFjeUUsR0E1RXBELElBQW1CQyxFQWlGbkIsU0FBU0QsRUFBZXBELEdBR3BCLEdBRkFBLEVBQUVDLE9BQU94QixVQUFVNkUsT0FBTyxZQUV0QjlHLEVBQ0EsSUFBSyxJQUFJYSxFQUFJLEVBQUdBLEVBQUlvRixFQUFhdkYsT0FBUUcsSUFDaEJrQixTQUFTb0IsY0FBYyxpQkFBaUJoRCxTQUFTOEMsRUFBT2xFLEtBQU84QixvQkFBb0JWLFNBQVM4QyxFQUFPakUsVUFDM0dpRCxVQUFVNkUsT0FBTyxpQkFHbEMsSUFBSyxJQUFJckcsRUFBSSxFQUFHQSxFQUFJd0YsRUFBYXZGLE9BQVFELElBQ2hCc0IsU0FBU29CLGNBQWMsaUJBQWlCaEQsU0FBUzhDLEVBQU9sRSx1QkFBdUJvQixTQUFTOEMsRUFBT2pFLEtBQU95QixPQUM5R3dCLFVBQVU2RSxPQUFPLFlBd0IxQyxJQUFJLEVBQWdCLFlBTXBCLFNBQVN4RCxJQUNMLElBQUl5RCxFQVFKLE9BTklBLEdBRGtCLGNBQWxCLEVBQzJCaEMsRUFHQUMsR0FUZDlELGFBWWI2RixHQUNzQixjQUFsQixFQUNBcEYsRUFBUXFDLEVBQVlpQixFQUFVdkcsS0FBTTZGLEVBQVU3RixNQUU5Q2lELEVBQVFxQyxFQUFZTyxFQUFVN0YsS0FBTXVHLEVBQVV2RyxXQUVsQzRGLEVEalFmb0Msb0JBQW9CLFFBQVNuRCxJQ29RUixjQUFsQixHQUNBLEVBQWdCLGlCQUNoQlosRUFDSTRCLEVBQ0FTLEVBQ0FWLEVBQ0FOLEdBQ0EsSUFHcUIsY0FBbEIsRUFDZ0IsWUFBbkJpQixFQUFVdkcsTUFDVixFQUFnQixpQkFDaEJpRSxFQUNJc0MsRUFDQUYsRUFDQVYsRUFDQUwsR0FDQSxLQUlKLEVBQWdCLGlCQUNoQnJCLEVBQ0lzQyxFQUNBRixFQUNBVixFQUNBTCxHQUNBLFNBbEJMLEVBMEJmLFNBQVNYLEVBQWNwRSxFQUFXRixFQUFLQyxHRnBTdkMsSUFBd0J5QyxFQUFRdUYsRUVxU0QvSCxFQUFVQyxNQUFNSCxHQUFLQyxHQUFLMkIsU0FBU1MsV0ZyUzFDSyxFRXVTRHVDLEVGdlNTZ0QsRUV1U0cvSCxFQUFVQyxNQUFNSCxHQUFLQyxHQUFLMkIsU0FBU2pDLEtGdFNsRStDLEVBQU9DLFlBQWMsa0NBQWtDc0YsS0FDdkQzRSxZQUFXLEtBQ1BaLEVBQU9DLFlBQWMsS0FDdEIsUSIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXBzL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL2JhdHRsZXNoaXBzL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwcy93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL2JhdHRsZXNoaXBzLy4vc3JjL1BsYXllci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwcy8uL3NyYy9HYW1lYm9hcmQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcHMvLi9zcmMvU2hpcC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwcy8uL3NyYy9TdGF0dXNNYW5pcC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwcy8uL3NyYy9nYW1lTG9vcC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwcy8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGUgcmVxdWlyZSBzY29wZVxudmFyIF9fd2VicGFja19yZXF1aXJlX18gPSB7fTtcblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsImNsYXNzIFBsYXllciB7XG5cbiAgICBjb25zdHJ1Y3RvcihuYW1lKSB7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWVcbiAgICAgICAgdGhpcy5jdXJyZW50cm93XG4gICAgICAgIHRoaXMuY3VycmVudGNvbFxuICAgIH1cblxuICAgIGF0dGFjayhyb3csIGNvbCwgZ2FtZWJvYXJkKSB7XG4gICAgICAgIGlmIChnYW1lYm9hcmQuYm9hcmRbcm93XVtjb2xdLmNhbkhpdCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3Qgc3VjY2VzcyA9IGdhbWVib2FyZC5yZWNlaXZlQXR0YWNrKHJvdywgY29sKVxuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJhbmRvbUF0dGFjayhnYW1lYm9hcmQpIHtcbiAgICAgICAgbGV0IHJvd1xuICAgICAgICBsZXQgY29sXG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIHJvdyA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKVxuICAgICAgICAgICAgY29sID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApXG4gICAgICAgIH1cbiAgICAgICAgd2hpbGUgKGdhbWVib2FyZC5ib2FyZFtyb3ddW2NvbF0uY2FuSGl0ID09PSBmYWxzZSlcbiAgICAgICAgY29uc3Qgc3VjY2VzcyA9IGdhbWVib2FyZC5yZWNlaXZlQXR0YWNrKHJvdywgY29sKVxuICAgICAgICB0aGlzLmdyYWJDb29yZHMocm93LGNvbClcbiAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdyYWJDb29yZHMocm93LCBjb2wpIHtcbiAgICAgICAgaWYgKHJvdyA9PT0gdW5kZWZpbmVkIHx8IGNvbCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHk6IHRoaXMuY3VycmVudHJvdyxcbiAgICAgICAgICAgICAgICB4OiB0aGlzLmN1cnJlbnRjb2xcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudHJvdyA9IHJvd1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50Y29sID0gY29sXG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJhbmRvbVBsYWNlbWVudChnYW1lYm9hcmQsIHNoaXApIHtcbiAgICAgICAgbGV0IHJvd1xuICAgICAgICBsZXQgY29sXG4gICAgICAgIGxldCB2ZXJ0aWNhbFxuICAgICAgICBkbyB7XG4gICAgICAgICAgICByb3cgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMClcbiAgICAgICAgICAgIGNvbCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKVxuICAgICAgICAgICAgdmVydGljYWwgPSB0aGlzLnZlcnRpY2FsUmFuZG9taXplcigpXG4gICAgICAgIH1cbiAgICAgICAgd2hpbGUgKGdhbWVib2FyZC5jYW5QbGFjZShzaGlwLCBwYXJzZUludChyb3cpLCBwYXJzZUludChjb2wpLCB2ZXJ0aWNhbCkgPT09IGZhbHNlKVxuICAgICAgICBnYW1lYm9hcmQucGxhY2VTaGlwKHNoaXAsIHBhcnNlSW50KHJvdyksIHBhcnNlSW50KGNvbCksIHZlcnRpY2FsKVxuICAgIH1cblxuICAgIHZlcnRpY2FsUmFuZG9taXplcigpIHtcbiAgICAgICAgY29uc3QgSXNWZXJ0aWNhbCA9IE1hdGgucmFuZG9tKCkgKiAxXG4gICAgICAgIGlmIChJc1ZlcnRpY2FsID49IDAuNSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgfSBlbHNlIGlmIChJc1ZlcnRpY2FsIDwgMC41KSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUGxheWVyIiwiaW1wb3J0IFNoaXAgZnJvbSAnLi9TaGlwLmpzJ1xuaW1wb3J0IFBsYXllciBmcm9tICcuL1BsYXllci5qcydcblxuY2xhc3MgR2FtZWJvYXJkIHtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmJvYXJkID0gW11cbiAgICAgICAgdGhpcy5jcmVhdGVHcmlkKDEwKVxuICAgIH1cblxuICAgIGNyZWF0ZUdyaWQoc2l6ZSkge1xuICAgICAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCBzaXplOyByb3crKykge1xuICAgICAgICAgICAgdGhpcy5ib2FyZFtyb3ddID0gW11cbiAgICAgICAgICAgIGZvciAobGV0IGNvbCA9IDA7IGNvbCA8IHNpemU7IGNvbCsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ib2FyZFtyb3ddW2NvbF0gPSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbkhpdDogdHJ1ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwbGFjZVNoaXAoU2hpcCwgcm93LCBjb2wsIHZlcnRpY2FsKSB7XG4gICAgICAgIFxuICAgICAgICBpZiAodGhpcy5jYW5QbGFjZShTaGlwLCByb3csIGNvbCwgdmVydGljYWwpID09PSBmYWxzZSkge1xuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cblxuICAgICAgICBpZiAodmVydGljYWwpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgU2hpcC5sZW5ndGg7IGkrKylcbiAgICAgICAgICAgIHRoaXMuYm9hcmRbcm93ICsgaV1bY29sXSA9IHtcbiAgICAgICAgICAgICAgICBTaGlwSW5mbzogU2hpcCxcbiAgICAgICAgICAgICAgICBoYXNTaGlwOiB0cnVlLFxuICAgICAgICAgICAgICAgIGNhbkhpdDogdHJ1ZSxcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgU2hpcC5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIHRoaXMuYm9hcmRbcm93XVtjb2wgKyBqXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgU2hpcEluZm86IFNoaXAsXG4gICAgICAgICAgICAgICAgICAgIGhhc1NoaXA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNhbkhpdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZWNlaXZlQXR0YWNrKHJvdywgY29sKSB7XG4gICAgICAgIHRoaXMuYm9hcmRbcm93XVtjb2xdLmNhbkhpdCA9IGZhbHNlXG4gICAgICAgIGlmICh0aGlzLmJvYXJkW3Jvd11bY29sXS5oYXNTaGlwID09PSB0cnVlKSB7XG4gICAgICAgICAgICBsZXQgaGl0aW5kZXggPSAodGhpcy5ib2FyZFtyb3ddW2NvbF0uU2hpcEluZm8uaGl0cy5sZW5ndGgpICsgMVxuICAgICAgICAgICAgdGhpcy5ib2FyZFtyb3ddW2NvbF0uU2hpcEluZm8uaGl0KGhpdGluZGV4KVxuICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgY2FuQXR0YWNrKHJvdywgY29sKSB7XG4gICAgICAgIGlmICh0aGlzLmJvYXJkW3Jvd11bY29sXS5jYW5IaXQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmJvYXJkW3Jvd11bY29sXS5jYW5IaXQgPT09IHRydWUpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlzR2FtZU92ZXIoKSB7XG4gICAgICAgIGxldCBnYW1lT3ZlclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYm9hcmQubGVuZ3RoOyBpKysgKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuYm9hcmRbMF0ubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5ib2FyZFtpXVtqXS5oYXNTaGlwID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5ib2FyZFtpXVtqXS5TaGlwSW5mby5pc1N1bmsoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1lT3ZlciA9IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZ2FtZU92ZXJcbiAgICB9XG5cbiAgICBjYW5QbGFjZShzaGlwLCByb3csIGNvbCwgdmVydGljYWwpIHtcbiAgICAgICAgaWYgKHZlcnRpY2FsKSB7XG4gICAgICAgICAgICBpZiAoKHBhcnNlSW50KHJvdykgKyBwYXJzZUludChzaGlwLmxlbmd0aCkpID4gMTApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICgoY29sICsgc2hpcC5sZW5ndGgpID4gMTApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG5cbiAgICAgICAgaWYgKHZlcnRpY2FsKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXAubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoXCJoYXNTaGlwXCIgaW4gdGhpcy5ib2FyZFtyb3craV1bY29sXSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5ib2FyZFtyb3cgKyBpXVtjb2xdLmhhc1NoaXAgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaGlwLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgaWYgKFwiaGFzU2hpcFwiIGluIHRoaXMuYm9hcmRbcm93XVtjb2wral0pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYm9hcmRbcm93XVtjb2wgKyBqXS5oYXNTaGlwID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEdhbWVib2FyZCIsImNsYXNzIFNoaXAge1xuICAgIGNvbnN0cnVjdG9yIChuYW1lLCBsZW5ndGgpIHtcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZVxuICAgICAgICB0aGlzLmxlbmd0aCA9IGxlbmd0aFxuICAgICAgICB0aGlzLmhpdHMgPSBbXVxuICAgIH1cblxuICAgIGhpdChudW1iZXIpIHtcbiAgICAgICAgaWYgKHRoaXMuaGl0cy5pbmNsdWRlcyhudW1iZXIpKSB7XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaGl0cy5wdXNoKG51bWJlcilcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlzU3VuaygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGl0cy5sZW5ndGggPT09IHRoaXMubGVuZ3RoXG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBTaGlwIiwiaW1wb3J0IHsgY3JlYXRlTmV3Qm9hcmRzLCBjcmVhdGVTaGlwcywgdGltZVRvUGxhY2UsIHZpc3VhbGl6ZXIgfSBmcm9tICcuL2luZGV4J1xuaW1wb3J0IFNoaXAgZnJvbSAnLi9TaGlwJ1xuXG5mdW5jdGlvbiB0ZXh0VGFsayhvYmplY3QpIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgb2JqZWN0LnRleHRDb250ZW50ID0gXCJMZXQncyBzdGFydCB3aXRoIHlvdXIgYmlnZ2VzdCBzaGlwLCB0aGUgQ2Fycmllci5cIiAgICBcbiAgICB9LCAzMDAwKVxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBjcmVhdGVTaGlwcygwKVxuICAgIH0sIDYwMDApXG59XG5cbmZ1bmN0aW9uIGVycm9ySGFuZGxlcihvYmplY3QsIG51bWJlciwgbmFtZSkge1xuc3dpdGNoIChudW1iZXIpIHtcbiAgICBjYXNlIDAgOlxuICAgICAgICBvYmplY3QudGV4dENvbnRlbnQgPSBgVGhhdCdzIG5vdCB0aGUgYm9hcmQsICR7bmFtZX0uYFxuICAgICAgICBicmVha1xuICAgIGNhc2UgMSA6XG4gICAgICAgIG9iamVjdC50ZXh0Q29udGVudCA9IGBZb3UgY2FuJ3QgcGxhY2UgaXQgdGhlcmUsICR7bmFtZX0uYFxuICAgICAgICBicmVha1xuICAgIGNhc2UgMiA6XG4gICAgICAgIG9iamVjdC50ZXh0Q29udGVudCA9IGBXZSBrbm93IHRoZXJlJ3Mgbm90aGluZyB0aGVyZSwgJHtuYW1lfSEgUGljayBhIGRpZmZlcmVudCBzcG90LmBcbiAgICAgICAgYnJlYWtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHNoaXBDcmVhdGlvbkhhbmRsZXIob2JqZWN0LCBzaGlwdHlwZSkge1xuICAgIGlmIChzaGlwdHlwZS5uYW1lID09PSAnQ2FycmllcicpIHtcbiAgICAgICAgb2JqZWN0LnRleHRDb250ZW50ID0gXCJXaGVyZSB3b3VsZCB5b3UgbGlrZSB0byBwbGFjZSB5b3VyIENhcnJpZXI/XCJcbiAgICAgICAgdGltZVRvUGxhY2UoKVxuICAgICAgICB2aXN1YWxpemVyKClcbiAgICB9IFxuICAgIGVsc2UgaWYgKHNoaXB0eXBlLm5hbWUgPT09ICdCYXR0bGVzaGlwJykge1xuICAgICAgICBvYmplY3QudGV4dENvbnRlbnQgPSBcIkhvdyBhYm91dCB0aGUgQmF0dGxlc2hpcD9cIlxuICAgICAgICB0aW1lVG9QbGFjZSgpXG4gICAgICAgIHZpc3VhbGl6ZXIoKVxuICAgIH0gXG4gICAgZWxzZSBpZiAoc2hpcHR5cGUubmFtZSA9PT0gJ0NydWlzZXInKSB7XG4gICAgICAgIG9iamVjdC50ZXh0Q29udGVudCA9ICdIb3cgYWJvdXQgdGhlIENydWlzZXIgc2hpcD8nXG4gICAgICAgIHRpbWVUb1BsYWNlKClcbiAgICAgICAgdmlzdWFsaXplcigpXG4gICAgfSBcbiAgICBlbHNlIGlmIChzaGlwdHlwZS5uYW1lID09PSAnU3VibWFyaW5lJykge1xuICAgICAgICBvYmplY3QudGV4dENvbnRlbnQgPSBcIkNhbid0IGZvcmdldCBhYm91dCBvdXIgU3VibWFyaW5lcyBub3csIGNhbiB3ZT9cIlxuICAgICAgICB0aW1lVG9QbGFjZSgpXG4gICAgICAgIHZpc3VhbGl6ZXIoKVxuICAgIH0gXG4gICAgZWxzZSBpZiAoc2hpcHR5cGUubmFtZSA9PT0gJ0Rlc3Ryb3llcicpIHtcbiAgICAgICAgb2JqZWN0LnRleHRDb250ZW50ID0gXCJMYXN0LCBidXQgbm90IGxlYXN0LCBvdXIgJ0Rlc3Ryb3llcic/XCJcbiAgICAgICAgdGltZVRvUGxhY2UoKVxuICAgICAgICB2aXN1YWxpemVyKClcbiAgICB9IFxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm5cbiAgICB9XG59XG5cbmZ1bmN0aW9uIGNoYW5nZURpcmVjdGlvbihvYmplY3QpIHtcbiAgICBjb25zdCBkaXJlY3Rpb25hbGl6ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKVxuICAgIGRpcmVjdGlvbmFsaXplci5jbGFzc0xpc3QuYWRkKCdjaGFuZ2VEaXJlY3Rpb24nKVxuICAgIG9iamVjdC5hcHBlbmRDaGlsZChkaXJlY3Rpb25hbGl6ZXIpXG4gICAgcmV0dXJuIGRpcmVjdGlvbmFsaXplclxufVxuXG5mdW5jdGlvbiBzdGFydEdhbWVUZXh0KG9iamVjdCwgbmFtZSkge1xuICAgIG9iamVjdC50ZXh0Q29udGVudCA9IGBBbHJpZ2h0LCB5b3UncmUgYWxsIHNldCwgJHtuYW1lfS5gXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIG9iamVjdC50ZXh0Q29udGVudCA9IFwiWW91J3JlIHVwIGZvciB0aGUgZmlyc3Qgc2hvdCwgbGV0J3MgZ2V0IHRoZW0hXCJcbiAgICB9LCAxNTAwKVxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBvYmplY3QudGV4dENvbnRlbnQgPSBcIlwiXG4gICAgfSwgNDAwMClcbn1cblxuZnVuY3Rpb24gc3RhdHVzU2hpcFN1bmsob2JqZWN0LCBzaGlwTmFtZSkge1xuICAgIG9iamVjdC50ZXh0Q29udGVudCA9IGBTaGlwIGRvd24hIFlvdSBoYXZlIHN1bmsgdGhlaXIgJHtzaGlwTmFtZX0uYFxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBvYmplY3QudGV4dENvbnRlbnQgPSBcIlwiXG4gICAgfSwgNDAwMClcbn1cblxuZnVuY3Rpb24gZW5kR2FtZShvYmplY3QsIHdpbm5lcm5hbWUsIGxvc2VybmFtZSkge1xuICAgIG9iamVjdC50ZXh0Q29udGVudCA9IGAke3dpbm5lcm5hbWV9IGhhcyBzdW5rIGFsbCBvZiAke2xvc2VybmFtZX0ncyBzaGlwcy5gXG4gICAgY29uc3QgcmVzdGFydCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIilcbiAgICByZXN0YXJ0LnRleHRDb250ZW50ID0gXCJQbGF5IGFnYWluP1wiXG4gICAgcmVzdGFydC5jbGFzc0xpc3QuYWRkKCdTdGFydCcpXG4gICAgcmVzdGFydC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgY3JlYXRlTmV3Qm9hcmRzKClcbiAgICB9KVxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBvYmplY3QuYXBwZW5kQ2hpbGQocmVzdGFydClcbiAgICB9LCA0MDAwKVxufVxuXG5leHBvcnQgeyB0ZXh0VGFsaywgZXJyb3JIYW5kbGVyLCBzaGlwQ3JlYXRpb25IYW5kbGVyLCBjaGFuZ2VEaXJlY3Rpb24sIHN0YXJ0R2FtZVRleHQsIHN0YXR1c1NoaXBTdW5rLCBlbmRHYW1lIH0iLCJpbXBvcnQgeyBjaGVja1NoaXBTdW5rLCBHYW1lTG9vcGVyIH0gZnJvbSBcIi5cIlxuaW1wb3J0IHsgZXJyb3JIYW5kbGVyIH0gZnJvbSBcIi4vU3RhdHVzTWFuaXBcIlxuaW1wb3J0IFBsYXllciBmcm9tICcuL1BsYXllcidcblxubGV0IGN1cnJlbnRwbGF5ZXJcbmxldCBjdXJyZW50Z2FtZWJvYXJkXG5sZXQgY3VycmVudGdyaWRcbmxldCBjdXJyZW50b2JqZWN0XG5cbmZ1bmN0aW9uIGF0dGFja0NsaWNrKHBsYXllciwgZ2FtZWJvYXJkLCBncmlkLCBvYmplY3QsIGFpKSB7XG4gICAgY29uc29sZS5sb2coZ2FtZWJvYXJkKVxuICAgIGN1cnJlbnRwbGF5ZXIgPSBwbGF5ZXJcbiAgICBjdXJyZW50Z2FtZWJvYXJkID0gZ2FtZWJvYXJkXG4gICAgY3VycmVudGdyaWQgPSBncmlkXG4gICAgY3VycmVudG9iamVjdCA9IG9iamVjdFxuICAgIGlmIChhaSkge1xuICAgICAgICBjb25zdCBzdWNjZXNzID0gcGxheWVyLnJhbmRvbUF0dGFjayhjdXJyZW50Z2FtZWJvYXJkKVxuICAgICAgICBjb25zdCBjb29yZHMgPSBwbGF5ZXIuZ3JhYkNvb3JkcygpXG4gICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgICAgYFtkYXRhLXljb29yZD0nJHtjb29yZHMueX0nXVtkYXRhLXhjb29yZD0nJHtjb29yZHMueH0nXWBcbiAgICAgICAgKVxuICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJQTEFZRVIgMiBISVQgWU9VXCIpXG4gICAgICAgICAgICBjZWxsLnNldEF0dHJpYnV0ZSgnaWQnLCAnaGl0JylcbiAgICAgICAgICAgIGNoZWNrU2hpcFN1bmsoY3VycmVudGdhbWVib2FyZCwgY29vcmRzLnksIGNvb3Jkcy54KVxuICAgICAgICAgICAgR2FtZUxvb3BlcigpXG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiUExBWUVSIDIgTUlTU0VEIFlPVVwiKVxuICAgICAgICAgICAgY2VsbC5zZXRBdHRyaWJ1dGUoJ2lkJywgJ21pc3MnKVxuICAgICAgICAgICAgR2FtZUxvb3BlcigpXG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIGdyaWQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBwbGF5Q2xpY2spXG4gICAgfVxufVxuXG5mdW5jdGlvbiBwbGF5Q2xpY2soZSkge1xuICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2NlbGwnKSkge1xuICAgICAgICBpZiAoY3VycmVudGdhbWVib2FyZC5jYW5BdHRhY2soXG4gICAgICAgICAgICBwYXJzZUludChlLnRhcmdldC5kYXRhc2V0Lnljb29yZCksXG4gICAgICAgICAgICBwYXJzZUludChlLnRhcmdldC5kYXRhc2V0Lnhjb29yZClcbiAgICAgICAgKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgY29uc3Qgc3VjY2VzcyA9IGN1cnJlbnRwbGF5ZXIuYXR0YWNrKFxuICAgICAgICAgICAgICAgIHBhcnNlSW50KGUudGFyZ2V0LmRhdGFzZXQueWNvb3JkKSxcbiAgICAgICAgICAgICAgICBwYXJzZUludChlLnRhcmdldC5kYXRhc2V0Lnhjb29yZCksXG4gICAgICAgICAgICAgICAgY3VycmVudGdhbWVib2FyZFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIllPVSBISVQgUExBWUVSIDJcIilcbiAgICAgICAgICAgICAgICBlLnRhcmdldC5zZXRBdHRyaWJ1dGUoJ2lkJywgJ2hpdCcpXG4gICAgICAgICAgICAgICAgY2hlY2tTaGlwU3VuayhjdXJyZW50Z2FtZWJvYXJkLCBlLnRhcmdldC5kYXRhc2V0Lnljb29yZCwgZS50YXJnZXQuZGF0YXNldC54Y29vcmQpXG4gICAgICAgICAgICAgICAgR2FtZUxvb3BlcigpXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiWU9VIE1JU1NFRCBQTEFZRVIgMlwiKVxuICAgICAgICAgICAgICAgIEdhbWVMb29wZXIoKVxuICAgICAgICAgICAgICAgIGUudGFyZ2V0LnNldEF0dHJpYnV0ZSgnaWQnLCAnbWlzcycpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlcnJvckhhbmRsZXIoY3VycmVudG9iamVjdCwgMiwgY3VycmVudHBsYXllci5uYW1lKVxuICAgICAgICAgICAgYXR0YWNrQ2xpY2soY3VycmVudHBsYXllciwgY3VycmVudGdhbWVib2FyZCwgY3VycmVudGdyaWQsIGN1cnJlbnRvYmplY3QsIGZhbHNlKVxuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgZXJyb3JIYW5kbGVyKGN1cnJlbnRvYmplY3QsIDEsIGN1cnJlbnRwbGF5ZXIubmFtZSlcbiAgICAgICAgYXR0YWNrQ2xpY2soY3VycmVudHBsYXllciwgY3VycmVudGdhbWVib2FyZCwgY3VycmVudGdyaWQsIGN1cnJlbnRvYmplY3QsIGZhbHNlKVxuICAgIH1cbn1cblxuZnVuY3Rpb24gcmVtb3ZlTGlzdGVuZXJzKGdyaWQpIHtcbiAgICBncmlkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcGxheUNsaWNrKVxufVxuXG5leHBvcnQge2F0dGFja0NsaWNrLCByZW1vdmVMaXN0ZW5lcnN9IiwiaW1wb3J0IFBsYXllciBmcm9tICcuL1BsYXllci5qcydcbmltcG9ydCBHYW1lYm9hcmQgZnJvbSAnLi9HYW1lYm9hcmQuanMnXG5pbXBvcnQgU2hpcCBmcm9tICcuL1NoaXAuanMnXG5pbXBvcnQgeyBjaGFuZ2VEaXJlY3Rpb24sIGVuZEdhbWUsIGVycm9ySGFuZGxlciwgc2hpcENyZWF0aW9uSGFuZGxlciwgc3RhcnRHYW1lVGV4dCwgc3RhdHVzU2hpcFN1bmssIHRleHRUYWxrIH0gZnJvbSAnLi9TdGF0dXNNYW5pcC5qcydcbmltcG9ydCB7IGF0dGFja0NsaWNrLCAgcmVtb3ZlTGlzdGVuZXJzIH0gZnJvbSAnLi9nYW1lTG9vcC5qcydcblxuLy9zaGlwc1xuY29uc3QgQXZhaWxhYmxlU2hpcHMgPSBbXG4gICAge1xuICAgICAgICBuYW1lOiAnQ2FycmllcicsXG4gICAgICAgIGxlbmd0aDogNVxuICAgIH0sXG4gICAge1xuICAgICAgICBuYW1lOiAnQmF0dGxlc2hpcCcsXG4gICAgICAgIGxlbmd0aDogNFxuICAgIH0sXG4gICAge1xuICAgICAgICBuYW1lOiAnQ3J1aXNlcicsXG4gICAgICAgIGxlbmd0aDogM1xuICAgIH0sXG4gICAge1xuICAgICAgICBuYW1lOiAnU3VibWFyaW5lJyxcbiAgICAgICAgbGVuZ3RoOiAzXG4gICAgfSxcbiAgICB7XG4gICAgICAgIG5hbWU6ICdEZXN0cm95ZXInLFxuICAgICAgICBsZW5ndGg6IDJcbiAgICB9XG5dXG5cbi8vZ2FtZSBsb29wXG5jb25zdCBTdGFydEdhbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1pZD1cInN0YXJ0XCJdJylcbmNvbnN0IFN0YXR1c0FyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1pZD1cInN0YXR1c1wiXScpXG5jb25zdCBlbnRlclBsYXllck9uZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWlkPVwicGxheWVyT25lTmFtZVNlbGVjdG9yXCJdJylcbmNvbnN0IGVudGVyTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWlkPVwiZW50ZXJOYW1lXCJdJylcbmNvbnN0IG5hbWVDaG9zZW5QbGF5ZXJPbmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1pZD1cIm5hbWVDaG9zZW5QbGF5ZXJPbmVcIl0nKVxuY29uc3QgcGxheWVyT25lTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWlkPVwicGxheWVyR3JpZE5hbWVcIl0nKVxuXG4vLy8vLy9wbGF5ZXIgZ3JpZHNcbmNvbnN0IHBsYXllck9uZUdyaWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1pZD1cImdyaWRQbGF5ZXJPbmVcIl0nKVxuY29uc3QgcGxheWVyVHdvR3JpZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWlkPVwiZ3JpZFBsYXllclR3b1wiXScpXG5cbi8vY3JlYXRlIGdhbWVcblN0YXJ0R2FtZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBTdGFydEdhbWUuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiXG4gICAgZW50ZXJQbGF5ZXJPbmUuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiXG59KVxuXG5sZXQgcGxheWVyT25lXG5cbmVudGVyTmFtZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBsZXQgbmFtZVBsYXllck9uZSA9ICdtYXRlJ1xuICAgIGlmIChuYW1lQ2hvc2VuUGxheWVyT25lLnZhbHVlID09PSBcIlwiKSB7XG4gICAgICAgIHBsYXllck9uZU5hbWUudGV4dENvbnRlbnQgPSAnWU9VUiBGTEVFVCdcbiAgICAgICAgbmFtZVBsYXllck9uZSA9IFwiQ2FwdGFpblwiXG4gICAgfSBlbHNlIHtcbiAgICAgICAgbmFtZVBsYXllck9uZSA9IG5hbWVDaG9zZW5QbGF5ZXJPbmUudmFsdWVcbiAgICAgICAgcGxheWVyT25lTmFtZS50ZXh0Q29udGVudCA9IGAke25hbWVQbGF5ZXJPbmUudG9VcHBlckNhc2UoKX0nUyBGTEVFVGBcbiAgICAgICAgbmFtZUNob3NlblBsYXllck9uZS52YWx1ZSA9IFwiXCJcbiAgICB9XG4gICAgZW50ZXJQbGF5ZXJPbmUuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiXG4gICAgU3RhdHVzQXJlYS50ZXh0Q29udGVudCA9IGBUaW1lIHRvIHBsYWNlIHlvdXIgc2hpcHMsICR7bmFtZVBsYXllck9uZX0uYFxuICAgIHRleHRUYWxrKFN0YXR1c0FyZWEpXG4gICAgXG4gICAgYWRkR3JpZChwbGF5ZXJPbmVHYW1lYm9hcmQsIHBsYXllck9uZUdyaWQsIFwicGxheWVyMVwiKVxuICAgIGFkZEdyaWQocGxheWVyVHdvR2FtZWJvYXJkLCBwbGF5ZXJUd29HcmlkLCBcInBsYXllcjJcIilcblxuICAgIHBsYXllck9uZSA9IG5ldyBQbGF5ZXIoYCR7bmFtZVBsYXllck9uZX1gKVxufSlcblxuXG5sZXQgcGxheWVyT25lR2FtZWJvYXJkID0gbmV3IEdhbWVib2FyZFxubGV0IHBsYXllclR3b0dhbWVib2FyZCA9IG5ldyBHYW1lYm9hcmRcbmxldCBwbGF5ZXJUd28gPSBuZXcgUGxheWVyKFwiTXIuIEJvdFwiKVxuXG5mdW5jdGlvbiBjcmVhdGVOZXdCb2FyZHMoKSB7XG4gICAgcGxheWVyT25lR2FtZWJvYXJkID0gbmV3IEdhbWVib2FyZFxuICAgIHBsYXllclR3b0dhbWVib2FyZCA9IG5ldyBHYW1lYm9hcmRcbiAgICBjbGVhbkJvYXJkcygpXG5cbiAgICBhZGRHcmlkKHBsYXllck9uZUdhbWVib2FyZCwgcGxheWVyT25lR3JpZCwgXCJwbGF5ZXIxXCIpXG4gICAgYWRkR3JpZChwbGF5ZXJUd29HYW1lYm9hcmQsIHBsYXllclR3b0dyaWQsIFwicGxheWVyMlwiKVxuXG4gICAgY3JlYXRlU2hpcHMoMClcbiAgICB6ID0gMVxuICAgIHZlcnRpY2FsID0gZmFsc2VcbiAgICBjdXJyZW50cGxheWVyID0gXCJwbGF5ZXJPbmVcIlxuICAgIHJldHVyblxufVxuXG5mdW5jdGlvbiBjbGVhbkJvYXJkcygpIHtcbiAgICBwbGF5ZXJPbmVHcmlkLmlubmVySFRNTCA9IFwiXCJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDExOyBpKyspIHtcbiAgICAgICAgY29uc3QgeWNvb3JkY2VsbHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuICAgICAgICB5Y29vcmRjZWxscy5jbGFzc0xpc3QuYWRkKCdjZWxsQ29vcmQnKVxuICAgICAgICB5Y29vcmRjZWxscy5jbGFzc0xpc3QuYWRkKCd5Q29vcmQnKVxuICAgICAgICBpZiAoaSA9PT0gMCkge1xuICAgICAgICAgICAgeWNvb3JkY2VsbHMudGV4dENvbnRlbnQgPSBcIlwiXG4gICAgICAgICAgICBwbGF5ZXJPbmVHcmlkLmFwcGVuZENoaWxkKHljb29yZGNlbGxzKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgeWNvb3JkY2VsbHMudGV4dENvbnRlbnQgPSBgJHtTdHJpbmcuZnJvbUNoYXJDb2RlKDY0K2kpfWBcbiAgICAgICAgICAgIHBsYXllck9uZUdyaWQuYXBwZW5kQ2hpbGQoeWNvb3JkY2VsbHMpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwbGF5ZXJUd29HcmlkLmlubmVySFRNTCA9IFwiXCJcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IDExOyBqKyspIHtcbiAgICAgICAgY29uc3QgeWNvb3JkY2VsbHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuICAgICAgICB5Y29vcmRjZWxscy5jbGFzc0xpc3QuYWRkKCdjZWxsQ29vcmQnKVxuICAgICAgICB5Y29vcmRjZWxscy5jbGFzc0xpc3QuYWRkKCd5Q29vcmQnKVxuICAgICAgICBpZiAoaiA9PT0gMTApIHtcbiAgICAgICAgICAgIHljb29yZGNlbGxzLnRleHRDb250ZW50ID0gXCJcIlxuICAgICAgICAgICAgcGxheWVyVHdvR3JpZC5hcHBlbmRDaGlsZCh5Y29vcmRjZWxscylcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHljb29yZGNlbGxzLnRleHRDb250ZW50ID0gYCR7U3RyaW5nLmZyb21DaGFyQ29kZSg2NStqKX1gXG4gICAgICAgICAgICBwbGF5ZXJUd29HcmlkLmFwcGVuZENoaWxkKHljb29yZGNlbGxzKVxuICAgICAgICB9XG4gICAgfVxufVxuXG4vLy8vbWFpbiBwbGF5ZXJcblxuLy8vZ2FtZWJvYXJkXG5mdW5jdGlvbiBhZGRHcmlkKGdhbWVib2FyZCwgZ3JpZCwgcGxheWVyKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBnYW1lYm9hcmQuYm9hcmQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAtMTsgaiA8IGdhbWVib2FyZC5ib2FyZC5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIgPT09IFwicGxheWVyMVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChqID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgeENvb3JkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICAgICAgICAgICAgICAgICAgICAgIHhDb29yZC50ZXh0Q29udGVudCA9IGAke2kgKzF9YFxuICAgICAgICAgICAgICAgICAgICAgICAgeENvb3JkLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnY2VsbENvb3JkJylcblxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZC5hcHBlbmRDaGlsZCh4Q29vcmQpXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwuc2V0QXR0cmlidXRlKCdjbGFzcycsICdjZWxsJylcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwuc2V0QXR0cmlidXRlKCdkYXRhLXlDb29yZCcsIGkpXG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsLnNldEF0dHJpYnV0ZSgnZGF0YS14Q29vcmQnLCBqKVxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZC5hcHBlbmRDaGlsZChjZWxsKSAgICBcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocGxheWVyID09PSBcInBsYXllcjJcIikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaiA8IDkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuICAgICAgICAgICAgICAgICAgICAgICAgY2VsbC5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ2NlbGwnKVxuICAgICAgICAgICAgICAgICAgICAgICAgY2VsbC5zZXRBdHRyaWJ1dGUoJ2RhdGEteUNvb3JkJywgaSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwuc2V0QXR0cmlidXRlKCdkYXRhLXhDb29yZCcsIGogKzEpXG4gICAgICAgICAgICAgICAgICAgICAgICBncmlkLmFwcGVuZENoaWxkKGNlbGwpXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB4Q29vcmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuICAgICAgICAgICAgICAgICAgICAgICAgeENvb3JkLnRleHRDb250ZW50ID0gYCR7aSArMX1gXG4gICAgICAgICAgICAgICAgICAgICAgICB4Q29vcmQuc2V0QXR0cmlidXRlKCdjbGFzcycsICdjZWxsQ29vcmQnKVxuICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZC5hcHBlbmRDaGlsZCh4Q29vcmQpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuZnVuY3Rpb24gY3JlYXRlU2hpcHMoc2hpcE51bWJlcikge1xuICAgIGlmIChwYXJzZUludChzaGlwTnVtYmVyKSA9PT0gQXZhaWxhYmxlU2hpcHMubGVuZ3RoKSB7XG4gICAgICAgIGRvbmVTaGlwUGxhY2VtZW50KClcbiAgICAgICAgcmV0dXJuXG4gICAgfVxuICAgIGxldCBzaGlwID0gbmV3IFNoaXAoQXZhaWxhYmxlU2hpcHNbc2hpcE51bWJlcl0ubmFtZSwgQXZhaWxhYmxlU2hpcHNbc2hpcE51bWJlcl0ubGVuZ3RoKVxuICAgIHNoaXBDcmVhdGlvbkhhbmRsZXIoU3RhdHVzQXJlYSwgc2hpcClcbiAgICBzZXRDdXJyZW50U2hpcChzaGlwKVxufVxuXG5sZXQgeiA9IDFcbmxldCB2ZXJ0aWNhbCA9IGZhbHNlXG5sZXQgY3VycmVudFNoaXBcbmxldCBjb29yZHNcbmxldCBwcmV2aW91c1NoaXBcblxuZnVuY3Rpb24gc2V0Q3VycmVudFNoaXAoc2hpcE5vdykge1xuICAgIHJldHVybiBjdXJyZW50U2hpcCA9IHNoaXBOb3dcbn1cblxuZnVuY3Rpb24gc2V0RGlyZWN0aW9uKCkge1xuICAgIHJldHVybiB2ZXJ0aWNhbCA9ICF2ZXJ0aWNhbFxufVxuXG5mdW5jdGlvbiBzZXREaXJlY3Rpb25UZXh0KHZlcnRpY2FsKSB7XG4gICAgaWYgKHZlcnRpY2FsKSB7XG4gICAgICAgcmV0dXJuIFwiVmVydGljYWxcIlxuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBcIkhvcml6b250YWxcIlxuICAgIH1cbn1cblxuZnVuY3Rpb24gc2V0Q29vcmRzKGN1cnJlbnRDb29yZHMpIHtcbiAgICByZXR1cm4gY29vcmRzID0gY3VycmVudENvb3Jkc1xufVxuXG5mdW5jdGlvbiBzZXRQcmV2aW91c1NoaXAoKSB7XG4gICAgcmV0dXJuIHByZXZpb3VzU2hpcCA9IGN1cnJlbnRTaGlwXG59XG5cbmZ1bmN0aW9uIHRpbWVUb1BsYWNlKCkge1xuICAgIGNvbnN0IGRpcmVjdGlvbkJ1dHRvbiA9IGNoYW5nZURpcmVjdGlvbihTdGF0dXNBcmVhKVxuICAgIGRpcmVjdGlvbkJ1dHRvbi50ZXh0Q29udGVudCA9IHNldERpcmVjdGlvblRleHQodmVydGljYWwpXG4gICAgZGlyZWN0aW9uQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICBzZXREaXJlY3Rpb24oKVxuICAgICAgICBkaXJlY3Rpb25CdXR0b24udGV4dENvbnRlbnQgPSBzZXREaXJlY3Rpb25UZXh0KHZlcnRpY2FsKVxuICAgIH0pXG4gICAgcGxheWVyT25lR3JpZC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHBsYWNlbWVudCwge29uY2U6IHRydWV9KVxufVxuXG5mdW5jdGlvbiBwbGFjZW1lbnQoZSkge1xuICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2NlbGwnKSkge1xuICAgICAgICBpZiAocGxheWVyT25lR2FtZWJvYXJkLmNhblBsYWNlKGN1cnJlbnRTaGlwLCBwYXJzZUludChlLnRhcmdldC5kYXRhc2V0Lnljb29yZCksIHBhcnNlSW50KGUudGFyZ2V0LmRhdGFzZXQueGNvb3JkKSwgdmVydGljYWwpID09PSB0cnVlKSB7XG4gICAgICAgICAgICBzZXRDb2xvcihlKVxuICAgICAgICAgICAgcGxheWVyT25lR2FtZWJvYXJkLnBsYWNlU2hpcChjdXJyZW50U2hpcCwgcGFyc2VJbnQoZS50YXJnZXQuZGF0YXNldC55Y29vcmQpLCBwYXJzZUludChlLnRhcmdldC5kYXRhc2V0Lnhjb29yZCksIHZlcnRpY2FsKVxuICAgICAgICAgICAgY2xlYXJFdmVudExpc3RlbmVycygpXG4gICAgICAgICAgICBjcmVhdGVTaGlwcyh6KVxuICAgICAgICAgICAgeisrXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlcnJvckhhbmRsZXIoU3RhdHVzQXJlYSwgMSwgcGxheWVyT25lLm5hbWUpXG4gICAgICAgICAgICB0aW1lVG9QbGFjZSgpXG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICBlcnJvckhhbmRsZXIoU3RhdHVzQXJlYSwgMCwgcGxheWVyT25lLm5hbWUpXG4gICAgICAgIHRpbWVUb1BsYWNlKClcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHNldENvbG9yKGUpIHtcbiAgICBlLnRhcmdldC5jbGFzc0xpc3QuYWRkKGAke3ByZXZpb3VzU2hpcC5uYW1lLnRvTG93ZXJDYXNlKCl9YClcbiAgICBpZiAodmVydGljYWwpIHtcbiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBwcmV2aW91c1NoaXAubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHNpYmxpbmdDZWxscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLXljb29yZD1cIiR7cGFyc2VJbnQoY29vcmRzLnJvdykgKyBqfVwiXVtkYXRhLXhjb29yZD1cIiR7cGFyc2VJbnQoY29vcmRzLmNvbCl9XCJdYClcbiAgICAgICAgICAgIHNpYmxpbmdDZWxscy5jbGFzc0xpc3QuYWRkKGAke3ByZXZpb3VzU2hpcC5uYW1lLnRvTG93ZXJDYXNlKCl9YClcbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcHJldmlvdXNTaGlwLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBzaWJsaW5nQ2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS15Y29vcmQ9XCIke3BhcnNlSW50KGNvb3Jkcy5yb3cpfVwiXVtkYXRhLXhjb29yZD1cIiR7cGFyc2VJbnQoY29vcmRzLmNvbCkgKyBpfVwiXWApXG4gICAgICAgICAgICBzaWJsaW5nQ2VsbHMuY2xhc3NMaXN0LmFkZChgJHtwcmV2aW91c1NoaXAubmFtZS50b0xvd2VyQ2FzZSgpfWApXG4gICAgICAgIH1cbiAgICB9XG59XG5cbmZ1bmN0aW9uIHZpc3VhbGl6ZXIoKSB7XG4gICAgcGxheWVyT25lR3JpZC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW92ZXInLCB2aXN1YWxpemVwbGFjZW1lbnQpXG59XG5cbmZ1bmN0aW9uIHZpc3VhbGl6ZXBsYWNlbWVudChlKSB7XG4gICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnY2VsbCcpKSB7XG4gICAgICAgIGlmIChwbGF5ZXJPbmVHYW1lYm9hcmQuY2FuUGxhY2UoY3VycmVudFNoaXAsIHBhcnNlSW50KGUudGFyZ2V0LmRhdGFzZXQueWNvb3JkKSwgcGFyc2VJbnQoZS50YXJnZXQuZGF0YXNldC54Y29vcmQpLCB2ZXJ0aWNhbCkgPT09IHRydWUpIHtcbiAgICAgICAgICAgIGUudGFyZ2V0LmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJylcbiAgICAgICAgICAgIHNldENvb3Jkcyhjb29yZHMgPSB7XG4gICAgICAgICAgICAgICAgcm93OiBlLnRhcmdldC5kYXRhc2V0Lnljb29yZCxcbiAgICAgICAgICAgICAgICBjb2w6IGUudGFyZ2V0LmRhdGFzZXQueGNvb3JkXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICBpZiAodmVydGljYWwpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGN1cnJlbnRTaGlwLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNpYmxpbmdDZWxscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLXljb29yZD1cIiR7cGFyc2VJbnQoY29vcmRzLnJvdykgKyBqfVwiXVtkYXRhLXhjb29yZD1cIiR7cGFyc2VJbnQoY29vcmRzLmNvbCl9XCJdYClcbiAgICAgICAgICAgICAgICAgICAgc2libGluZ0NlbGxzLmNsYXNzTGlzdC5hZGQoJ3NlbGVjdGVkJylcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY3VycmVudFNoaXAubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2libGluZ0NlbGxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEteWNvb3JkPVwiJHtwYXJzZUludChjb29yZHMucm93KX1cIl1bZGF0YS14Y29vcmQ9XCIke3BhcnNlSW50KGNvb3Jkcy5jb2wpICsgaX1cIl1gKVxuICAgICAgICAgICAgICAgICAgICBzaWJsaW5nQ2VsbHMuY2xhc3NMaXN0LmFkZCgnc2VsZWN0ZWQnKVxuICAgICAgICAgICAgICAgIH0gICAgXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZXRQcmV2aW91c1NoaXAoKVxuICAgICAgICAgICAgZS50YXJnZXQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsIGNsZWFydmlzdWFsaXplKVxuICAgICAgICB9XG4gICAgfVxufVxuXG5mdW5jdGlvbiBjbGVhcnZpc3VhbGl6ZShlKSB7XG4gICAgZS50YXJnZXQuY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0ZWQnKVxuXG4gICAgaWYgKHZlcnRpY2FsKSB7XG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgcHJldmlvdXNTaGlwLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBjb25zdCBzaWJsaW5nQ2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS15Y29vcmQ9XCIke3BhcnNlSW50KGNvb3Jkcy5yb3cpICsgan1cIl1bZGF0YS14Y29vcmQ9XCIke3BhcnNlSW50KGNvb3Jkcy5jb2wpfVwiXWApXG4gICAgICAgICAgICBzaWJsaW5nQ2VsbHMuY2xhc3NMaXN0LnJlbW92ZSgnc2VsZWN0ZWQnKVxuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwcmV2aW91c1NoaXAubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHNpYmxpbmdDZWxscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLXljb29yZD1cIiR7cGFyc2VJbnQoY29vcmRzLnJvdyl9XCJdW2RhdGEteGNvb3JkPVwiJHtwYXJzZUludChjb29yZHMuY29sKSArIGl9XCJdYClcbiAgICAgICAgICAgIHNpYmxpbmdDZWxscy5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZCcpXG4gICAgICAgIH1cbiAgICB9XG59XG5cbmZ1bmN0aW9uIGNsZWFyRXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgcGxheWVyT25lR3JpZC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW92ZXInLCB2aXN1YWxpemVwbGFjZW1lbnQpXG4gICAgcGxheWVyT25lR3JpZC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgY2xlYXJ2aXN1YWxpemUpXG59XG5cbi8vLy9BSSBwbGFjZW1lbnRcblxuZnVuY3Rpb24gZG9uZVNoaXBQbGFjZW1lbnQoKSB7XG4gICAgc3RhcnRHYW1lVGV4dChTdGF0dXNBcmVhLCBwbGF5ZXJPbmUubmFtZSlcblxuICAgIC8vQUkgcmFuZG9tIHBsYWNlbWVudFxuICAgIEF2YWlsYWJsZVNoaXBzLmZvckVhY2goc2hpcCA9PiB7XG4gICAgICAgIGxldCBuZXdTaGlwID0gbmV3IFNoaXAoc2hpcC5uYW1lLCBzaGlwLmxlbmd0aClcbiAgICAgICAgcGxheWVyVHdvLnJhbmRvbVBsYWNlbWVudChwbGF5ZXJUd29HYW1lYm9hcmQsIG5ld1NoaXApXG4gICAgfSlcblxuICAgIEdhbWVMb29wZXIoKVxufVxuXG5sZXQgY3VycmVudHBsYXllciA9IFwicGxheWVyT25lXCJcblxuZnVuY3Rpb24gY2hlY2tHYW1lT3ZlcihnYW1lYm9hcmQpIHtcbiAgICByZXR1cm4gZ2FtZWJvYXJkLmlzR2FtZU92ZXIoKVxufVxuXG5mdW5jdGlvbiBHYW1lTG9vcGVyKCkge1xuICAgIGxldCBpc0dhbWVEb25lXG4gICAgaWYgKGN1cnJlbnRwbGF5ZXIgPT09IFwicGxheWVyT25lXCIpIHtcbiAgICAgICAgaXNHYW1lRG9uZSA9IGNoZWNrR2FtZU92ZXIocGxheWVyT25lR2FtZWJvYXJkKVxuXG4gICAgfSBlbHNlIHtcbiAgICAgICAgaXNHYW1lRG9uZSA9IGNoZWNrR2FtZU92ZXIocGxheWVyVHdvR2FtZWJvYXJkKVxuICAgIH1cbiAgICBcbiAgICBpZiAoaXNHYW1lRG9uZSkge1xuICAgICAgICBpZiAoY3VycmVudHBsYXllciA9PT0gXCJwbGF5ZXJPbmVcIikge1xuICAgICAgICAgICAgZW5kR2FtZShTdGF0dXNBcmVhLCBwbGF5ZXJUd28ubmFtZSwgcGxheWVyT25lLm5hbWUpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlbmRHYW1lKFN0YXR1c0FyZWEsIHBsYXllck9uZS5uYW1lLCBwbGF5ZXJUd28ubmFtZSlcbiAgICAgICAgfVxuICAgICAgICByZW1vdmVMaXN0ZW5lcnMocGxheWVyVHdvR3JpZClcbiAgICAgICAgcmV0dXJuXG4gICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGN1cnJlbnRwbGF5ZXIgPT09IFwicGxheWVyT25lXCIpIHtcbiAgICAgICAgICAgIGN1cnJlbnRwbGF5ZXIgPSBcInBsYXllclR3b1wiXG4gICAgICAgICAgICBhdHRhY2tDbGljayhcbiAgICAgICAgICAgICAgICBwbGF5ZXJPbmUsXG4gICAgICAgICAgICAgICAgcGxheWVyVHdvR2FtZWJvYXJkLFxuICAgICAgICAgICAgICAgIHBsYXllclR3b0dyaWQsXG4gICAgICAgICAgICAgICAgU3RhdHVzQXJlYSxcbiAgICAgICAgICAgICAgICBmYWxzZVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIH0gZWxzZSBpZiAoY3VycmVudHBsYXllciA9PT0gXCJwbGF5ZXJUd29cIikge1xuICAgICAgICAgICAgaWYgKHBsYXllclR3by5uYW1lID09PSBcIk1yLiBCb3RcIikge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRwbGF5ZXIgPSBcInBsYXllck9uZVwiXG4gICAgICAgICAgICAgICAgYXR0YWNrQ2xpY2soXG4gICAgICAgICAgICAgICAgICAgIHBsYXllclR3byxcbiAgICAgICAgICAgICAgICAgICAgcGxheWVyT25lR2FtZWJvYXJkLFxuICAgICAgICAgICAgICAgICAgICBwbGF5ZXJPbmVHcmlkLFxuICAgICAgICAgICAgICAgICAgICBTdGF0dXNBcmVhLFxuICAgICAgICAgICAgICAgICAgICB0cnVlIFxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY3VycmVudHBsYXllciA9IFwicGxheWVyT25lXCJcbiAgICAgICAgICAgICAgICBhdHRhY2tDbGljayhcbiAgICAgICAgICAgICAgICAgICAgcGxheWVyVHdvLFxuICAgICAgICAgICAgICAgICAgICBwbGF5ZXJPbmVHYW1lYm9hcmQsXG4gICAgICAgICAgICAgICAgICAgIHBsYXllck9uZUdyaWQsXG4gICAgICAgICAgICAgICAgICAgIFN0YXR1c0FyZWEsXG4gICAgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuXG5mdW5jdGlvbiBjaGVja1NoaXBTdW5rKGdhbWVib2FyZCwgcm93LCBjb2wpIHtcbiAgICBjb25zdCBzaGlwSXNTdW5rUmVtaW5kZXIgPSBnYW1lYm9hcmQuYm9hcmRbcm93XVtjb2xdLlNoaXBJbmZvLmlzU3VuaygpXG4gICAgaWYgKHNoaXBJc1N1bmtSZW1pbmRlcikge1xuICAgICAgICBzdGF0dXNTaGlwU3VuayhTdGF0dXNBcmVhLCBnYW1lYm9hcmQuYm9hcmRbcm93XVtjb2xdLlNoaXBJbmZvLm5hbWUpXG4gICAgfVxufVxuXG5cbmV4cG9ydCB7IHRpbWVUb1BsYWNlLCBjcmVhdGVTaGlwcywgdmlzdWFsaXplciwgR2FtZUxvb3BlciwgY2hlY2tTaGlwU3VuaywgY3JlYXRlTmV3Qm9hcmRzIH0iXSwibmFtZXMiOlsiX193ZWJwYWNrX3JlcXVpcmVfXyIsImV4cG9ydHMiLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJjb25zdHJ1Y3RvciIsIm5hbWUiLCJ0aGlzIiwiY3VycmVudHJvdyIsImN1cnJlbnRjb2wiLCJhdHRhY2siLCJyb3ciLCJjb2wiLCJnYW1lYm9hcmQiLCJib2FyZCIsImNhbkhpdCIsInJlY2VpdmVBdHRhY2siLCJyYW5kb21BdHRhY2siLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJzdWNjZXNzIiwiZ3JhYkNvb3JkcyIsInVuZGVmaW5lZCIsInkiLCJ4IiwicmFuZG9tUGxhY2VtZW50Iiwic2hpcCIsInZlcnRpY2FsIiwidmVydGljYWxSYW5kb21pemVyIiwiY2FuUGxhY2UiLCJwYXJzZUludCIsInBsYWNlU2hpcCIsIklzVmVydGljYWwiLCJjcmVhdGVHcmlkIiwic2l6ZSIsIlNoaXAiLCJpIiwibGVuZ3RoIiwiU2hpcEluZm8iLCJoYXNTaGlwIiwiaiIsImhpdGluZGV4IiwiaGl0cyIsImhpdCIsImNhbkF0dGFjayIsImlzR2FtZU92ZXIiLCJnYW1lT3ZlciIsImlzU3VuayIsIm51bWJlciIsImluY2x1ZGVzIiwicHVzaCIsImVycm9ySGFuZGxlciIsIm9iamVjdCIsInRleHRDb250ZW50IiwiZW5kR2FtZSIsIndpbm5lcm5hbWUiLCJsb3Nlcm5hbWUiLCJyZXN0YXJ0IiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNyZWF0ZU5ld0JvYXJkcyIsInNldFRpbWVvdXQiLCJhcHBlbmRDaGlsZCIsImN1cnJlbnRwbGF5ZXIiLCJjdXJyZW50Z2FtZWJvYXJkIiwiY3VycmVudGdyaWQiLCJjdXJyZW50b2JqZWN0IiwiYXR0YWNrQ2xpY2siLCJwbGF5ZXIiLCJncmlkIiwiYWkiLCJjb25zb2xlIiwibG9nIiwiY29vcmRzIiwiY2VsbCIsInF1ZXJ5U2VsZWN0b3IiLCJzZXRBdHRyaWJ1dGUiLCJjaGVja1NoaXBTdW5rIiwiR2FtZUxvb3BlciIsInBsYXlDbGljayIsImUiLCJ0YXJnZXQiLCJjb250YWlucyIsImRhdGFzZXQiLCJ5Y29vcmQiLCJ4Y29vcmQiLCJBdmFpbGFibGVTaGlwcyIsIlN0YXJ0R2FtZSIsIlN0YXR1c0FyZWEiLCJlbnRlclBsYXllck9uZSIsImVudGVyTmFtZSIsIm5hbWVDaG9zZW5QbGF5ZXJPbmUiLCJwbGF5ZXJPbmVOYW1lIiwicGxheWVyT25lR3JpZCIsInBsYXllclR3b0dyaWQiLCJwbGF5ZXJPbmUiLCJzdHlsZSIsImRpc3BsYXkiLCJuYW1lUGxheWVyT25lIiwidmFsdWUiLCJ0b1VwcGVyQ2FzZSIsImNyZWF0ZVNoaXBzIiwiYWRkR3JpZCIsInBsYXllck9uZUdhbWVib2FyZCIsInBsYXllclR3b0dhbWVib2FyZCIsInBsYXllclR3byIsImlubmVySFRNTCIsInljb29yZGNlbGxzIiwiU3RyaW5nIiwiZnJvbUNoYXJDb2RlIiwiY2xlYW5Cb2FyZHMiLCJ6IiwieENvb3JkIiwic2hpcE51bWJlciIsImZvckVhY2giLCJuZXdTaGlwIiwic2hpcHR5cGUiLCJ0aW1lVG9QbGFjZSIsInZpc3VhbGl6ZXIiLCJzaGlwQ3JlYXRpb25IYW5kbGVyIiwiY3VycmVudFNoaXAiLCJwcmV2aW91c1NoaXAiLCJzZXREaXJlY3Rpb25UZXh0IiwiZGlyZWN0aW9uQnV0dG9uIiwiZGlyZWN0aW9uYWxpemVyIiwiY2hhbmdlRGlyZWN0aW9uIiwicGxhY2VtZW50Iiwib25jZSIsInRvTG93ZXJDYXNlIiwic2V0Q29sb3IiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwidmlzdWFsaXplcGxhY2VtZW50IiwiY2xlYXJ2aXN1YWxpemUiLCJjdXJyZW50Q29vcmRzIiwicmVtb3ZlIiwiaXNHYW1lRG9uZSIsInNoaXBOYW1lIl0sInNvdXJjZVJvb3QiOiIifQ==